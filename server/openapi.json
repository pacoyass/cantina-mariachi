{
  "openapi": "3.0.3",
  "info": { "title": "Cantina API", "version": "1.0.0" },
  "servers": [{ "url": "/api" }],
  "components": {
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "example": "error" },
          "error": {
            "type": "object",
            "properties": {
              "type": { "type": "string" },
              "message": { "type": "string" },
              "details": { "type": "object", "nullable": true },
              "code": { "type": "integer" }
            },
            "required": ["type", "message", "code"]
          },
          "timestamp": { "type": "string", "format": "date-time" }
        },
        "required": ["status", "error", "timestamp"]
      },
      "Success": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "example": "success" },
          "message": { "type": "string" },
          "data": { "type": "object" },
          "timestamp": { "type": "string", "format": "date-time" }
        },
        "required": ["status", "message", "data", "timestamp"]
      },
      "Category": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "order": { "type": "integer" }
        },
        "required": ["id", "name", "order"]
      },
      "MenuItem": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "price": { "type": "number" },
          "available": { "type": "boolean" },
          "categoryId": { "type": "string" }
        },
        "required": ["id", "name", "price", "available", "categoryId"]
      },
      "OrderItemInput": {
        "type": "object",
        "properties": {
          "menuItemId": { "type": "string" },
          "quantity": { "type": "integer", "minimum": 1 }
        },
        "required": ["menuItemId", "quantity"]
      },
      "Order": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "orderNumber": { "type": "integer" },
          "status": { "type": "string", "enum": ["PENDING","CONFIRMED","PREPARING","READY","OUT_FOR_DELIVERY","DELIVERED","CANCELLED"] },
          "total": { "type": "number" },
          "trackingCode": { "type": "string" },
          "createdAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id","orderNumber","status","total","createdAt"]
      },
      "OrderCreateRequest": {
        "type": "object",
        "properties": {
          "items": { "type": "array", "items": { "$ref": "#/components/schemas/OrderItemInput" } },
          "notes": { "type": "string" },
          "delivery": { "type": "object", "nullable": true, "properties": {
            "address": { "type": "string" },
            "phone": { "type": "string" }
          }}
        },
        "required": ["items"]
      },
      "OrderCreatedResponse": {
        "allOf": [
          { "$ref": "#/components/schemas/Success" },
          { "type": "object", "properties": { "data": { "type": "object", "properties": { "order": { "$ref": "#/components/schemas/Order" } } } } }
        ]
      },
      "Driver": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "phone": { "type": "string" },
          "status": { "type": "string", "enum": ["ACTIVE","INACTIVE","OFFLINE"] }
        },
        "required": ["id","name","phone","status"]
      },
      "DriverCreateRequest": {
        "type": "object",
        "properties": { "name": { "type": "string" }, "phone": { "type": "string" } },
        "required": ["name","phone"]
      },
      "CashTransaction": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "driverId": { "type": "string" },
          "amount": { "type": "number" },
          "status": { "type": "string", "enum": ["PENDING","CONFIRMED","VERIFIED"] }
        },
        "required": ["id","driverId","amount","status"]
      },
      "CashCreateRequest": {
        "type": "object",
        "properties": { "driverId": { "type": "string" }, "amount": { "type": "number" } },
        "required": ["driverId","amount"]
      },
      "Reservation": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "phone": { "type": "string" },
          "date": { "type": "string", "format": "date" },
          "time": { "type": "string" },
          "partySize": { "type": "integer" },
          "status": { "type": "string", "enum": ["PENDING","CONFIRMED","CANCELLED","COMPLETED"] }
        },
        "required": ["id","name","phone","date","time","partySize","status"]
      },
      "ReservationCreateRequest": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "phone": { "type": "string" },
          "date": { "type": "string", "format": "date" },
          "time": { "type": "string" },
          "partySize": { "type": "integer", "minimum": 1 }
        },
        "required": ["name","phone","date","time","partySize"]
      },
      "NotificationDispatchRequest": {
        "type": "object",
        "properties": {
          "type": { "type": "string", "enum": ["EMAIL","SMS","PUSH","WEBHOOK"] },
          "target": { "type": "string" },
          "content": { "type": "string" }
        },
        "required": ["type","target","content"]
      },
      "NotificationDispatchResponse": {
        "allOf": [
          { "$ref": "#/components/schemas/Success" },
          { "type": "object", "properties": { "data": { "type": "object", "properties": { "success": { "type": "boolean" } } } } }
        ]
      },
      "Webhook": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "url": { "type": "string", "format": "uri" },
          "status": { "type": "string", "enum": ["ACTIVE","DISABLED"] }
        },
        "required": ["id","url","status"]
      },
      "WebhookRegisterRequest": {
        "type": "object",
        "properties": { "url": { "type": "string", "format": "uri" }, "event": { "type": "string" } },
        "required": ["url","event"]
      },
      "WebhookTriggerRequest": {
        "type": "object",
        "properties": { "event": { "type": "string" }, "payload": { "type": "object" } },
        "required": ["event","payload"]
      }
    }
  },
  "paths": {
    "/healthz": {
      "get": { "summary": "Health", "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Success" } } } } } }
    },
    "/menu/categories": {
      "get": {
        "summary": "List categories",
        "responses": {
          "200": { "description": "OK", "headers": { "ETag": { "schema": { "type": "string" } } }, "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "categories": { "type": "array", "items": { "$ref": "#/components/schemas/Category" } }, "cached": { "type": "boolean" } } } } } ] } } } }
        }
      }
    },
    "/menu/items": {
      "get": {
        "summary": "List items",
        "parameters": [ { "name": "categoryId", "in": "query", "required": false, "schema": { "type": "string" } } ],
        "responses": {
          "200": { "description": "OK", "headers": { "ETag": { "schema": { "type": "string" } } }, "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "items": { "type": "array", "items": { "$ref": "#/components/schemas/MenuItem" } }, "cached": { "type": "boolean" } } } } } ] } } } }
        }
      }
    },
    "/orders": {
      "post": {
        "summary": "Create order",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OrderCreateRequest" } } } },
        "responses": {
          "201": { "description": "Created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OrderCreatedResponse" } } } },
          "400": { "description": "Bad Request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Error" } } } }
        }
      }
    },
    "/orders/{orderNumber}": {
      "get": {
        "summary": "Get order",
        "parameters": [ { "name": "orderNumber", "in": "path", "required": true, "schema": { "type": "string" } } ],
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "order": { "$ref": "#/components/schemas/Order" } } } } } ] } } } },
          "404": { "description": "Not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Error" } } } }
        }
      }
    },
    "/orders/track/by": {
      "get": {
        "summary": "Track order",
        "parameters": [
          { "name": "orderNumber", "in": "query", "required": true, "schema": { "type": "string" } },
          { "name": "code", "in": "query", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "order": { "$ref": "#/components/schemas/Order" } } } } } ] } } } },
          "404": { "description": "Not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Error" } } } }
        }
      }
    },
    "/drivers": {
      "get": {
        "summary": "List drivers",
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "drivers": { "type": "array", "items": { "$ref": "#/components/schemas/Driver" } } } } } } ] } } } } }
      },
      "post": {
        "summary": "Create driver",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DriverCreateRequest" } } } },
        "responses": { "201": { "description": "Created", "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "driver": { "$ref": "#/components/schemas/Driver" } } } } } ] } } } } }
      }
    },
    "/drivers/assign": {
      "post": {
        "summary": "Assign order to driver",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "orderId": { "type": "string" }, "driverId": { "type": "string" } }, "required": ["orderId","driverId"] } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Success" } } } } }
      }
    },
    "/cash": {
      "post": {
        "summary": "Create cash transaction",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CashCreateRequest" } } } },
        "responses": { "201": { "description": "Created", "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "transaction": { "$ref": "#/components/schemas/CashTransaction" } } } } } ] } } } } }
      }
    },
    "/cash/confirm": {
      "post": {
        "summary": "Confirm cash transaction",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "transactionId": { "type": "string" } }, "required": ["transactionId"] } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Success" } } } } }
      }
    },
    "/cash/verify": {
      "post": {
        "summary": "Verify cash transaction",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "transactionId": { "type": "string" } }, "required": ["transactionId"] } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Success" } } } } }
      }
    },
    "/reservations": {
      "get": {
        "summary": "List reservations",
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "reservations": { "type": "array", "items": { "$ref": "#/components/schemas/Reservation" } } } } } } ] } } } } }
      },
      "post": {
        "summary": "Create reservation",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReservationCreateRequest" } } } },
        "responses": { "201": { "description": "Created", "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "reservation": { "$ref": "#/components/schemas/Reservation" } } } } } ] } } } } }
      }
    },
    "/notifications/dispatch": {
      "post": {
        "summary": "Dispatch notification",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NotificationDispatchRequest" } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NotificationDispatchResponse" } } } } }
      }
    },
    "/webhooks": {
      "get": {
        "summary": "List webhooks",
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "webhooks": { "type": "array", "items": { "$ref": "#/components/schemas/Webhook" } } } } } } ] } } } } }
      },
      "post": {
        "summary": "Register webhook",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/WebhookRegisterRequest" } } } },
        "responses": { "201": { "description": "Created", "content": { "application/json": { "schema": { "allOf": [ { "$ref": "#/components/schemas/Success" }, { "type": "object", "properties": { "data": { "type": "object", "properties": { "webhook": { "$ref": "#/components/schemas/Webhook" } } } } } ] } } } } }
      }
    },
    "/webhooks/trigger": {
      "post": {
        "summary": "Trigger webhooks",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/WebhookTriggerRequest" } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Success" } } } } }
      }
    }
  }
}